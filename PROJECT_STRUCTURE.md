# ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

## å®Œæ•´ç›®å½•æ ‘

```
stock_analyzer/
â”œâ”€â”€ ğŸ“„ README.md                      # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ USAGE.md                       # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md           # æœ¬æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ requirements.txt               # Pythonä¾èµ–åŒ…
â”œâ”€â”€ ğŸ“„ .env.example                   # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ .env                           # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ ğŸ“„ .gitignore                     # Gitå¿½ç•¥è§„åˆ™
â”‚
â”œâ”€â”€ ğŸš€ main.py                        # å®ç›˜è¿è¡Œå…¥å£
â”œâ”€â”€ ğŸ”„ run_backtest_optimized.py     # å›æµ‹ç³»ç»Ÿå…¥å£
â”œâ”€â”€ ğŸ“§ send_detailed_report.py       # é‚®ä»¶æŠ¥å‘Šå‘é€
â”œâ”€â”€ ğŸ“Š generate_backtest_report.py   # å›æµ‹æŠ¥å‘Šç”Ÿæˆ
â”‚
â”œâ”€â”€ ğŸ“‚ config/                        # é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ config.py                    # å®ç›˜é…ç½®ï¼ˆä¸¥æ ¼æ ‡å‡†ï¼‰
â”‚   â”œâ”€â”€ backtest_config.py           # å›æµ‹é…ç½®ï¼ˆç•¥å®½æ¾ï¼‰
â”‚   â””â”€â”€ dividend_override.py         # è‚¡æ¯ç‡æ‰‹åŠ¨ä¿®æ­£é…ç½®ï¼ˆv4.5æ–°å¢ï¼‰
â”‚
â”œâ”€â”€ ğŸ“‚ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ data/                     # æ•°æ®è·å–æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ data_fetcher.py          # è‚¡ç¥¨æ•°æ®è·å–ï¼ˆakshareï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ analysis/                 # åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ stock_filter.py          # æ ¸å¿ƒç­›é€‰é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ market_analyzer.py       # å¸‚åœºåˆ†æ
â”‚   â”‚   â””â”€â”€ backtest.py              # å›æµ‹å¼•æ“
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ notification/             # é€šçŸ¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ email_sender.py          # é‚®ä»¶å‘é€
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“‚ scheduler/                # è°ƒåº¦æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ task_scheduler.py        # å®šæ—¶ä»»åŠ¡
â”‚
â”œâ”€â”€ ğŸ“‚ cache/                         # æ•°æ®ç¼“å­˜ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ csi300_stocks_with_names.pkl # æ²ªæ·±300æˆåˆ†è‚¡
â”‚   â””â”€â”€ stock_*.pkl                  # è‚¡ç¥¨å†å²æ•°æ®
â”‚
â”œâ”€â”€ ğŸ“‚ logs/                          # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ stock_analyzer.log           # ç³»ç»Ÿè¿è¡Œæ—¥å¿—
â”‚
â””â”€â”€ ğŸ“‚ tests/                         # æµ‹è¯•ç›®å½•ï¼ˆæœªæ¥ï¼‰
    â””â”€â”€ __init__.py
```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### å…¥å£æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | è¿è¡Œæ–¹å¼ |
|------|------|---------|
| `main.py` | å®ç›˜é€‰è‚¡ | `python main.py` |
| `run_backtest_optimized.py` | å†å²å›æµ‹ | `python run_backtest_optimized.py` |
| `send_detailed_report.py` | å‘é€é‚®ä»¶ | è‡ªåŠ¨è°ƒç”¨æˆ–æ‰‹åŠ¨è¿è¡Œ |

### é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | å…³é”®å‚æ•° |
|------|------|---------|
| `config/config.py` | å®ç›˜é…ç½® | PE=30, æˆäº¤é¢=5000ä¸‡, åˆ†æ•°â‰¥50 |
| `config/backtest_config.py` | å›æµ‹é…ç½® | PE=30, æˆäº¤é¢=3000ä¸‡, åˆ†æ•°â‰¥50 |
| `.env` | é‚®ç®±å¯†ç  | EMAIL_ADDRESS, EMAIL_PASSWORD |

### æ ¸å¿ƒæ¨¡å—

#### 1. æ•°æ®è·å– (`src/data/data_fetcher.py`)

```python
class StockDataFetcher:
    - get_stock_realtime_data()      # è·å–å®æ—¶æ•°æ®
    - get_stock_historical_data()    # è·å–å†å²æ•°æ®
    - calculate_momentum()           # è®¡ç®—åŠ¨é‡æŒ‡æ ‡
```

#### 2. è‚¡ç¥¨ç­›é€‰ (`src/analysis/stock_filter.py`)

```python
class StockFilter:
    - calculate_strength_score()     # è®¡ç®—å¼ºåŠ¿åˆ†æ•°ï¼ˆåŒ…å«åˆ†é¡¹å¾—åˆ†ï¼‰
    - filter_by_pe_ratio()          # PEç­›é€‰
    - filter_by_strength()          # å¼ºåŠ¿ç­›é€‰
    - select_top_stocks()           # é€‰æ‹©TOP3
```

**åˆ†é¡¹å¾—åˆ†è¯´æ˜ (v4.5æœ€æ–°ç‰ˆ)**:
- **æŠ€æœ¯é¢ (30åˆ†)**: æ¶¨è·Œå¹…(10åˆ†)ã€åŠ¨é‡(15åˆ†)ã€**æµåŠ¨æ€§-æ¢æ‰‹ç‡(5åˆ†ï¼Œv4.5ä¼˜åŒ–)**
- **ä¼°å€¼ (25åˆ†)**: PE(<10â†’10åˆ†), PB(<2â†’10åˆ†,<7â†’5åˆ†,å¯¹æˆé•¿è‚¡æ›´å‹å¥½), PEG(<1â†’5åˆ†)
- **ç›ˆåˆ©èƒ½åŠ› (30åˆ†)**: ROE(>20%â†’15åˆ†)ã€åˆ©æ¶¦å¢é•¿ç‡(>30%â†’15åˆ†)
- **å®‰å…¨æ€§ (10åˆ†)**: PBå®‰å…¨è¾¹é™…(<1.0â†’3åˆ†,èŒƒå›´ä¸¥æ ¼), è‚¡æ¯ç‡(>5%â†’3åˆ†), æ¢æ‰‹ç‡(<2%â†’4åˆ†,æƒé‡å¢åŠ )
- **è‚¡æ¯ (5åˆ†)**: è‚¡æ¯ç‡å¾—åˆ†(>5%â†’5åˆ†ï¼Œ**æ”¯æŒæ‰‹åŠ¨ä¿®æ­£ï¼Œv4.5æ–°å¢**)

**v4.5æœ€æ–°ä¼˜åŒ– (2025-11-04)**:
- âœ… **æµåŠ¨æ€§æ”¹ç”¨æ¢æ‰‹ç‡** - æ¶ˆé™¤å¸‚å€¼å½±å“ï¼Œå¤§å°ç›˜å…¬å¹³å¯¹å¾…
- âœ… **è‚¡æ¯ç‡æ‰‹åŠ¨ä¿®æ­£** - ä¿®æ­£APIæ•°æ®ä¸å‡†ç¡®ï¼ˆå¦‚ä¸­å›½äººå¯¿5.55%â†’1.48%ï¼‰
- âœ… **è¯†åˆ«æŠ•æœºé£é™©** - é«˜æ¢æ‰‹ç‡(>8%)æ‰£åˆ†

**v4.4å…³é”®ä¼˜åŒ–**:
- PEæŒ‰10,20,30åˆ’åˆ†,æ›´ç¬¦åˆå¸‚åœºä¼°å€¼
- PBä¼°å€¼æ”¾å®½è‡³<10éƒ½ç»™åˆ†,æƒé‡å¢åŠ è‡³10åˆ†
- PBå®‰å…¨è¾¹é™…ä¸¥æ ¼åŒ–(<2.5æ‰ç»™åˆ†),æƒé‡é™è‡³3åˆ†
- æ˜ç¡®åŒºåˆ†"ä¼°å€¼åˆç†æ€§"å’Œ"å®‰å…¨è¾¹é™…"æ¦‚å¿µ
- æ¢æ‰‹ç‡æƒé‡å¢åŠ è‡³4åˆ†,è¡¥å¿çœŸå®æ•°æ®æƒé‡

#### 3. å›æµ‹å¼•æ“ (`run_backtest_optimized.py`)

```python
class OptimizedBacktest:
    - backtest_single_day()         # å•æ—¥å›æµ‹
    - backtest_multi_days()         # å¤šæ—¥å›æµ‹
    - get_csi300_stocks()           # è·å–æˆåˆ†è‚¡
```

## æ•°æ®æµç¨‹

### å®ç›˜æµç¨‹

```
main.py
  â†“
è·å–æ²ªæ·±300æˆåˆ†è‚¡ (data_fetcher)
  â†“
è·å–å®æ—¶æ•°æ® (data_fetcher)
  â†“
è®¡ç®—åŠ¨é‡å’Œå¼ºåŠ¿åˆ†æ•° (stock_filter)
  â†“
å¤šç»´åº¦ç­›é€‰ (stock_filter)
  â†“
é€‰å‡ºTOP3 (stock_filter)
  â†“
å‘é€é‚®ä»¶ (email_sender)
```

### å›æµ‹æµç¨‹

```
run_backtest_optimized.py
  â†“
åŠ è½½é…ç½® (backtest_config)
  â†“
è·å–å†å²æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰
  â†“
è®¡ç®—å†å²åŠ¨é‡
  â†“
ä½¿ç”¨å›æµ‹é…ç½®ç­›é€‰
  â†“
æ¨¡æ‹Ÿä¹°å–ï¼Œè®¡ç®—æ”¶ç›Š
  â†“
ä¿å­˜JSONç»“æœ
```

## é…ç½®æ–‡ä»¶å¯¹æ¯”

### å®ç›˜ vs å›æµ‹

| å‚æ•° | å®ç›˜ | å›æµ‹ | åŸå›  |
|------|------|------|------|
| PEä¸Šé™ | 30 | 30 | ä¸€è‡´ |
| æˆäº¤é¢ | 5000ä¸‡ | 3000ä¸‡ | å›æµ‹æ”¾å®½ï¼Œå¢åŠ æ ·æœ¬ |
| å¼ºåŠ¿åˆ†æ•° | â‰¥50 | â‰¥50 | ä¸€è‡´ |
| æ¨èæ•°é‡ | 3åª | 3åª | ä¸€è‡´ |
| è‚¡ç¥¨æ±  | 300åª | 300åª | å…¨é‡åˆ†æ |

## ç¼“å­˜æœºåˆ¶

### ç¼“å­˜æ–‡ä»¶

```
cache/
â”œâ”€â”€ csi300_stocks_with_names.pkl    # æ²ªæ·±300æˆåˆ†è‚¡ï¼ˆ7å¤©æœ‰æ•ˆï¼‰
â”œâ”€â”€ stock_600519_2025-04-07.pkl    # èŒ…å°å†å²æ•°æ®
â””â”€â”€ stock_000001_2025-04-07.pkl    # å¹³å®‰é“¶è¡Œå†å²æ•°æ®
```

### ç¼“å­˜ç­–ç•¥

- **æˆåˆ†è‚¡**: ç¼“å­˜7å¤©
- **è‚¡ç¥¨æ•°æ®**: æŒ‰æ—¥æœŸç¼“å­˜ï¼Œ7å¤©è¿‡æœŸ
- **è‡ªåŠ¨æ¸…ç†**: è¶…è¿‡7å¤©è‡ªåŠ¨å¤±æ•ˆ

## æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—æ–‡ä»¶

```
logs/
â”œâ”€â”€ stock_analyzer.log              # ä¸»æ—¥å¿—
â””â”€â”€ backtest_*.txt                  # å›æµ‹æŠ¥å‘Š
```

### æ—¥å¿—çº§åˆ«

- `INFO`: æ­£å¸¸è¿è¡Œä¿¡æ¯
- `WARNING`: è­¦å‘Šä¿¡æ¯ï¼ˆå¦‚æ•°æ®ç¼ºå¤±ï¼‰
- `ERROR`: é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ç½‘ç»œæ•…éšœï¼‰

## ç¯å¢ƒå˜é‡

### .env æ–‡ä»¶ç»“æ„

```env
# é‚®ç®±é…ç½®
EMAIL_ADDRESS=your_email@qq.com
EMAIL_PASSWORD=your_smtp_password
```

### ä½¿ç”¨æ–¹å¼

```python
from dotenv import load_dotenv
import os

load_dotenv()
email = os.getenv('EMAIL_ADDRESS')
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ç­›é€‰æŒ‡æ ‡

1. ä¿®æ”¹ `src/analysis/stock_filter.py`
2. åœ¨ `calculate_strength_score()` ä¸­æ·»åŠ æ–°æŒ‡æ ‡
3. è°ƒæ•´æƒé‡åˆ†é…

### æ·»åŠ æ–°çš„æ•°æ®æº

1. ä¿®æ”¹ `src/data/data_fetcher.py`
2. æ·»åŠ æ–°çš„è·å–æ–¹æ³•
3. æ›´æ–°ç¼“å­˜é€»è¾‘

### è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿

1. ä¿®æ”¹ `src/notification/email_sender.py`
2. æ›´æ–° `generate_report()` æ–¹æ³•

## ä¾èµ–å…³ç³»

```
main.py
  â”œâ”€â”€ data_fetcher (è·å–æ•°æ®)
  â”œâ”€â”€ stock_filter (ç­›é€‰è‚¡ç¥¨)
  â””â”€â”€ email_sender (å‘é€é‚®ä»¶)

run_backtest_optimized.py
  â”œâ”€â”€ data_fetcher (è·å–å†å²æ•°æ®)
  â”œâ”€â”€ stock_filter (ç­›é€‰è‚¡ç¥¨)
  â””â”€â”€ backtest_config (å›æµ‹é…ç½®)
```

## æ³¨æ„äº‹é¡¹

1. **ä¸è¦æäº¤ .env æ–‡ä»¶** - åŒ…å«æ•æ„Ÿä¿¡æ¯
2. **å®šæœŸæ¸…ç† cache/** - é¿å…å ç”¨å¤ªå¤šç©ºé—´
3. **å¤‡ä»½ logs/** - ä¿ç•™é‡è¦æ—¥å¿—
4. **æµ‹è¯•åå†å®ç›˜** - å…ˆç”¨å›æµ‹éªŒè¯ç­–ç•¥

---

ğŸ“š æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [README.md](README.md) å’Œ [USAGE.md](USAGE.md)
